<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exponent Sniper M.5 - GitHub Version</title>
    <style>
        body { background: #05070a; color: #00ff41; font-family: 'Courier New', monospace; text-align: center; margin: 0; padding: 10px; }
        .game-wrapper { max-width: 600px; margin: 0 auto; position: relative; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .modal { background: #0f1510; border: 2px solid #00ff41; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px #00ff41; width: 85%; max-width: 400px; }
        .info-panel { background: #0f1510; border: 1px solid #00ff41; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
        .stats-row { display: flex; justify-content: space-around; margin: 10px 0; font-weight: bold; border-bottom: 1px dashed #333; padding-bottom: 5px; }
        canvas { border: 1px solid #00ff41; background: #000; box-shadow: 0 0 20px rgba(0, 255, 65, 0.2); max-width: 100%; height: auto; }
        input { background: #000; border: 1px solid #00ff41; color: #00ff41; padding: 10px; width: 100px; text-align: center; outline: none; margin: 5px; }
        button { background: #00ff41; color: #000; border: none; padding: 10px 25px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        button:hover { background: #fff; box-shadow: 0 0 15px #fff; }
        button:disabled { background: #444; cursor: not-allowed; }
        #feedback { font-size: 1.1rem; height: 30px; font-weight: bold; margin: 10px 0; }
        .loading-dots:after { content: '...'; animation: dots 1s infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
    </style>
</head>
<body>

<div class="game-wrapper">
    <div id="login-screen" class="overlay">
        <div class="modal">
            <h3>üöÄ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Sniper (‡∏°.5)</h3>
            <p style="color: #ff4141; font-size: 0.8rem;">‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤: 10 ‡∏Ç‡πâ‡∏≠ | ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡πÅ‡∏ï‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 0!</p>
            <input type="text" id="p-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" style="width: 80%"><br>
            <input type="text" id="p-class" placeholder="‡∏ä‡∏±‡πâ‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 5/1)" style="width: 40%">
            <input type="number" id="p-no" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà" style="width: 30%">
            <br><button onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</button>
        </div>
    </div>

    <div id="finish-screen" class="overlay" style="display:none;">
        <div class="modal">
            <h2 style="color:#ffff00">üèÅ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</h2>
            <div id="final-stats" style="text-align:left; margin: 20px 0; line-height: 1.8;"></div>
            <p id="save-status" style="font-size: 0.9rem; color: #00ff41;"></p>
            <button onclick="location.reload()">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        </div>
    </div>

    <h2>üéØ Exponent Sniper</h2>
    <div class="info-panel">
        <div id="player-display" style="font-size: 0.8rem; color: #888;"></div>
        <div class="stats-row">
            <div>‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà: <span id="round-count">1</span>/10</div>
            <div>Score: <span id="score-val" style="color:#ffff00">0</span></div>
        </div>
        <div>Target: <strong>y = <span id="target-y">?</span></strong> | Base: <strong>a = <span id="current-base">?</span></strong></div>
    </div>

    <div class="input-group">
        <span>‡∏Ñ‡πà‡∏≤ x = </span>
        <input type="number" id="user-exponent" step="0.1" autofocus>
        <button id="fireBtn">FIRE!</button>
    </div>
    <p id="feedback">‡πÄ‡∏•‡πá‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏¢‡∏¥‡∏á!</p>
    <canvas id="graphCanvas" width="550" height="550"></canvas>
</div>

<script>
    const canvas = document.getElementById('graphCanvas');
    const ctx = canvas.getContext('2d');
    const inputEl = document.getElementById('user-exponent');
    const fireBtn = document.getElementById('fireBtn');
    const scale = 50; 

    // *** ‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏°‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ***
    const SCRIPT_URL = "‡πÉ‡∏™‡πà_WEB_APP_URL_‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"; 

    let base, targetX, targetY, lastUserX = null, score = 0, round = 1, isHit = false;
    let playerInfo = {};

    function startGame() {
        playerInfo = {
            name: document.getElementById('p-name').value,
            class: document.getElementById('p-class').value,
            no: document.getElementById('p-no').value
        };
        if (!playerInfo.name || !playerInfo.class || !playerInfo.no) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('player-display').innerText = `üë§ ${playerInfo.name} ‡∏°.${playerInfo.class} #${playerInfo.no}`;
        initRound();
    }

    function initRound() {
        if (round > 10) return finishGame();
        document.getElementById('round-count').innerText = round;
        const basePool = [2, 3, 5, 0.5, 0.2];
        const exps = [-2, -1, 0, 0.5, 1, 2];
        base = basePool[Math.floor(Math.random() * basePool.length)];
        targetX = exps[Math.floor(Math.random() * exps.length)];
        targetY = Math.pow(base, targetX);
        document.getElementById('current-base').innerText = base;
        document.getElementById('target-y').innerText = Number(targetY.toFixed(3));
        inputEl.value = ''; lastUserX = null; isHit = false; draw();
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const cx = canvas.width/2, cy = canvas.height/2 + 100;
        ctx.strokeStyle = "#111";
        for(let i=-10; i<=10; i++) {
            ctx.beginPath(); ctx.moveTo(cx+i*scale,0); ctx.lineTo(cx+i*scale,canvas.height); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,cy-i*scale); ctx.lineTo(canvas.width,cy-i*scale); ctx.stroke();
        }
        ctx.strokeStyle = "#333"; ctx.beginPath(); ctx.moveTo(0,cy); ctx.lineTo(canvas.width,cy); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(cx,0); ctx.lineTo(cx,canvas.height); ctx.stroke();

        if (lastUserX !== null) {
            ctx.strokeStyle = "#fff"; ctx.lineWidth = 4; ctx.beginPath();
            let first = true;
            for (let x = -10; x <= lastUserX; x += 0.05) {
                let py = cy - Math.pow(base, x) * scale;
                if (first) { ctx.moveTo(cx+x*scale, py); first = false; } else { ctx.lineTo(cx+x*scale, py); }
            }
            ctx.stroke();
        }
        ctx.fillStyle = isHit ? "#fff" : "red";
        ctx.beginPath(); ctx.arc(cx+targetX*scale, cy-targetY*scale, isHit?15:8, 0, Math.PI*2); ctx.fill();
    }

   // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fire() ---
function fire() {
    const userInput = inputEl.value.trim();
    if (userInput === "") return;

    // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°)
    lastUserX = parseFloat(userInput);

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (lastUserX) ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö targetX (‡πÄ‡∏•‡∏Ç‡∏ä‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏ß‡πâ) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    // ‡πÉ‡∏ä‡πâ Math.abs ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
    if (Math.abs(lastUserX - targetX) < 0.01) {
        isHit = true; 
        score += 10;
        document.getElementById('feedback').innerText = "üéØ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏°‡∏≤‡∏Å";
        document.getElementById('feedback').style.color = "#00ff41";
    } else {
        // ‡∏ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
        document.getElementById('feedback').innerText = `‚ùå ‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏õ‡∏ô‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏≠ ${targetX}`;
        document.getElementById('feedback').style.color = "#ff4141";
    }

    document.getElementById('score-val').innerText = score;
    draw(); 
    round++; 
    
    // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢‡∏ö‡∏ô‡∏Å‡∏£‡∏≤‡∏ü
    setTimeout(initRound, 1500);
}

// ‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listener ‡πÉ‡∏´‡πâ‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏¥‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
inputEl.addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        fire();
    }
});


    async function finishGame() {
        document.getElementById('finish-screen').style.display = 'flex';
        document.getElementById('final-stats').innerHTML = `‡∏ä‡∏∑‡πà‡∏≠: ${playerInfo.name}<br>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: ${score} ‡πÅ‡∏ï‡πâ‡∏°`;
        document.getElementById('save-status').className = 'loading-dots';
        document.getElementById('save-status').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô';
        
        try {
            await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({...playerInfo, score: score})
            });
            document.getElementById('save-status').className = '';
            document.getElementById('save-status').innerText = '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheet (Game2) ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
        } catch (e) {
            document.getElementById('save-status').innerText = '‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL)';
        }
    }

    fireBtn.onclick = fire;
    inputEl.onkeydown = (e) => e.key === 'Enter' && fire();
</script>
</body>
</html>

